<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jordan Ouellette-Plante" />

<meta name="date" content="2021-11-18" />

<title>Calculs des captures à l’âge</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Morue</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01_preparation_programme.html">1. Préparation initiale</a>
</li>
<li>
  <a href="02_preparation_data.html">2. Préparation des intrants</a>
</li>
<li>
  <a href="03_calculs.html">3. Calculs</a>
</li>
<li>
  <a href="04_comparaisons_valeurs_historiques.html">4. Comparaisons avec valeurs historiques</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Calculs des captures à l’âge</h1>
<h4 class="author">Jordan Ouellette-Plante</h4>
<h4 class="date">2021-11-18</h4>

</div>


<div id="objectifs" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Objectifs</h1>
<p>Calculer les :</p>
<ul>
<li>Captures à l’âge annuelles</li>
<li>Poids moyens à l’âge annuelles</li>
<li>Longueur moyennes à l’âge annuelles</li>
</ul>
</div>
<div id="initialisation" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Initialisation</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour le fichier Rmarkdown</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> T, <span class="at">collapse =</span> T, <span class="at">fig.align =</span> <span class="st">&quot;center&quot;</span>, <span class="at">fig.width =</span> <span class="dv">9</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fig.height =</span> <span class="dv">6</span>, <span class="at">message =</span> F, <span class="at">warning =</span> F)</span></code></pre></div>
<div id="répertoires-et-infos-utiles" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Répertoires et infos utiles</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">&quot;.R&quot;</span>) <span class="co"># https://gist.github.com/noamross/a549ee50e8a4fd68b8b1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">purl</span>(<span class="at">input =</span> <span class="st">&quot;01_preparation_programme.Rmd&quot;</span>, <span class="at">output =</span> temp, <span class="at">quiet =</span> T)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;C:\\Users\\OUELLE~1\\AppData\\Local\\Temp\\1\\RtmpYJazxz\\file12b460e07b49.R&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(temp)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;~/R/Fonctions_DSDB/plot_diag_lm.R&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>) <span class="co"># pour les figures diagnostiques de régressions</span></span></code></pre></div>
</div>
<div id="packages-requis" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> packages requis</h2>
<p>Des packages supplémentaires sont requis.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span></code></pre></div>
</div>
</div>
<div id="relations-masse-longueur" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Relations masse-longueur</h1>
<p>Le poids des échantillons est souvent manquant et n’est pas corrigé pour avoir la valeur en équivalents <em>poissons ronds</em>. Pour pallier à ça, le poids des échantillons est reconstruit d’après les fréquences de longueur associées à chaque échantillon. J’utilise une courbe masse-longueur provenant des relevés écosystémiques d’été (série <em>Alfred Needler</em>/<em>Teleost</em>) et d’hiver (série <em>Gadus Atlantica</em>). Pour les mois de janvier-mars et octobre-décembre, la relation masse-longueur obtenue d’après le relevé hivernal a été utilisée. Si aucune donnée du relevé hivernal n’était disponible ou si les mois étaient avril-septembre, la relation masse-longueur obtenue d’après le relevé estival était utilisée. Cette approche était celle utilisée par <span class="citation"><a href="#ref-Frechet1992_fr" role="doc-biblioref">Fréchet et Schwab</a> (<a href="#ref-Frechet1992_fr" role="doc-biblioref">1992</a>)</span>. Pour les années où je n’ai aucune donnée, j’utilise les données les plus rapprochées disponibles.</p>
<p>J’utilise la même méthode que dans <span class="citation"><a href="#ref-Bourdages2011_fr" role="doc-biblioref">Bourdages et Ouellet</a> (<a href="#ref-Bourdages2011_fr" role="doc-biblioref">2011</a>)</span> pour éliminer certaines morues à ne pas utiliser dans le calcul de la relation masse-longueur.</p>
<p>EVB utilise les données biologiques de l’échantillonnage à quai pour le maquereau. Pour la morue, le poids individuel n’est cependant pas une valeur prise et c’est pour cette raison que je me rabats sur les données des relevés écosystémiques du MPO.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Série AN-TE</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(intrant_ngsl) <span class="co"># ouvre ngsl</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dat_NGSL <span class="ot">&lt;-</span> ngsl<span class="sc">$</span>carbio <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(longueur), <span class="sc">!</span><span class="fu">is.na</span>(pds_tot)) <span class="sc">%&gt;%</span> <span class="co"># je me fous de type_ech, je veux le plus de morues</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">left_join</span>(., ngsl<span class="sc">$</span>set <span class="sc">%&gt;%</span> <span class="fu">select</span>(nav, rel, trait, annee, opano), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;nav&quot;</span>, <span class="st">&quot;rel&quot;</span>, <span class="st">&quot;trait&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;estival&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(nav, rel, trait, espece, annee, longueur, pds_tot, type, opano)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat_NGSL) <span class="co"># 53111 obs et 9 var</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 53111     9</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(ngsl)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Série Gadus</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(intrant_Gadus) <span class="co"># ouvre gadus</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>dat_GA <span class="ot">&lt;-</span> gadus<span class="sc">$</span>carbio <span class="sc">%&gt;%</span> </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(longueur), <span class="sc">!</span><span class="fu">is.na</span>(pds_tot)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">left_join</span>(., gadus<span class="sc">$</span>set <span class="sc">%&gt;%</span> <span class="fu">select</span>(nav, rel, trait, annee, opano), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;nav&quot;</span>, <span class="st">&quot;rel&quot;</span>, <span class="st">&quot;trait&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;hivernal&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(nav, rel, trait, espece, annee, longueur, pds_tot, type, opano)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat_GA) <span class="co"># 14296 obs et 9 var</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 14296     9</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(gadus)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combinaison des données. J&#39;utilise toutes les morues disponibles, qu&#39;importe leur provenance</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(dat_NGSL, dat_GA)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dat) <span class="co"># 67407 obs et 9 var</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 67407     9</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat_NGSL, dat_GA)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>opano, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># d&#39;où proviennent les morues de 4Vn et 3Ps?</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="do">##   3Pn   3Ps    4R    4S    4T   4Vn  &lt;NA&gt; </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  4506   354 35007 23426  3896   218     0</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(opano <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;3Ps&quot;</span>, <span class="st">&quot;4Vn&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(nav, annee, type, opano) <span class="sc">%&gt;%</span> count</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 5</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="do">## # Groups:   nav, annee, type, opano [4]</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="do">##     nav annee type     opano     n</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt; &lt;int&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    20  1994 hivernal 3Ps     354</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 2    20  1994 hivernal 4Vn     199</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 3    39  2006 estival  4Vn      11</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="do">## 4    39  2009 estival  4Vn       8</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Je crois que ces stations ont été faites par inadvertance à l&#39;extérieur de 4RST...</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des relations masse-longueur</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>rels <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">annee =</span> <span class="fu">c</span>(<span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>, <span class="dv">1993</span><span class="sc">:</span><span class="dv">1994</span>),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;estival&quot;</span>, <span class="fu">length</span>(<span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>)), <span class="fu">rep</span>(<span class="st">&quot;hivernal&quot;</span>, <span class="dv">2</span>)),</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">n_brute =</span> <span class="cn">NA</span>, </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">n_net =</span> <span class="cn">NA</span>, </span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">intercept =</span> <span class="cn">NA</span>, </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>               <span class="at">slope =</span> <span class="cn">NA</span>, </span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>               <span class="at">r_squared =</span> <span class="cn">NA</span>, </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>               <span class="at">source =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(annee, type)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>rels</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 30 x 8</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="do">##    annee type     n_brute n_net intercept slope r_squared source</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;chr&gt;    &lt;lgl&gt;   &lt;lgl&gt; &lt;lgl&gt;     &lt;lgl&gt; &lt;lgl&gt;     &lt;lgl&gt; </span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1993 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1993 hivernal NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1994 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1994 hivernal NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1995 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1996 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1997 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1998 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1999 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  2000 estival  NA      NA    NA        NA    NA        NA    </span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 20 more rows</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>diags <span class="ot">&lt;-</span> <span class="fu">list</span>() <span class="co"># liste vide où je vais mettre toutes les figures diagnostiques</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(rels)){</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> rels<span class="sc">$</span>annee[i]</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> rels<span class="sc">$</span>type[i]</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sélection des morues à utiliser</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(dat, annee <span class="sc">==</span> y <span class="sc">&amp;</span> type <span class="sc">==</span> t))</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ménage des données pour le modèle, comme dans @Bourdages2011_fr</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> dat[cor, ] <span class="co"># données à utiliser</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>n_brute[i] <span class="ot">&lt;-</span> <span class="fu">length</span>(cor) <span class="co"># nombre de morues initialement disponible</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(pds_tot <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">~</span> <span class="fu">log</span>(longueur <span class="sc">/</span> <span class="dv">10</span>), <span class="at">data =</span> temp) <span class="co"># longueur en cm, poids en kg.</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  resid_studentized <span class="ot">&lt;-</span> <span class="fu">rstudent</span>(mod)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hist(resid_studentized, main = &quot;Studentized Residual Distribution&quot;)</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>  <span class="co"># J&#39;enlève les lignes où la valeurs des résidus est &lt; -1.5 ou &gt; 1.5 (comme Hugo)</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">#length(resid_studentized)</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(resid_studentized) <span class="sc">&lt;=</span> <span class="fl">1.5</span>)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">#length(cor)</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcul des coefficients à utiliser avec les données nettoyées</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> temp[cor, ] <span class="co"># les morues que je conserve au final</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>n_net[i] <span class="ot">&lt;-</span> <span class="fu">length</span>(cor) <span class="co"># nombre de morues utilisées au final pour établir la relation masse-longueur</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(pds_tot <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">~</span> <span class="fu">log</span>(longueur <span class="sc">/</span> <span class="dv">10</span>), <span class="at">data =</span> temp) <span class="co"># longueur en cm, poids en kg.</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Création des figures de diagnostique (1 par année)</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>  title <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="fu">paste0</span>(y, <span class="st">&quot;-&quot;</span>, t), <span class="at">fontface =</span> <span class="st">&#39;bold&#39;</span>)</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">plot_diag_lm</span>(mod, <span class="at">langue =</span> <span class="st">&quot;fr&quot;</span>)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  diags[[i]] <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(title, graph, </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>)) </span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transfert des valeurs utiles dans une table</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>intercept[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(mod))[<span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">round</span>(., <span class="dv">3</span>) <span class="co"># conserve 3 décimales</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>slope[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">summary</span>(mod))[<span class="dv">2</span>] <span class="sc">%&gt;%</span> <span class="fu">round</span>(., <span class="dv">3</span>) <span class="co"># conserve 3 décimales</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>r_squared[i] <span class="ot">&lt;-</span> <span class="fu">summary</span>(mod)<span class="sc">$</span>adj.r.squared <span class="sc">%&gt;%</span> <span class="fu">round</span>(., <span class="dv">3</span>) <span class="co"># conserve 3 décimales</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>  rels<span class="sc">$</span>source[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(t <span class="sc">==</span> <span class="st">&quot;estival&quot;</span>, <span class="fu">paste</span>(<span class="st">&quot;RE&quot;</span>, y), <span class="fu">paste</span>(<span class="st">&quot;RH&quot;</span>, y)) <span class="co"># RE = relevé estival, RH = relevé hivernal</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(y, t, cor, temp, mod, resid_studentized, title, graph)  </span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Comment sont les figures diagnostiques?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>do_it <span class="ot">&lt;-</span> T <span class="co"># si je le roule ou pas, car long processus</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (do_it <span class="sc">==</span> T){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(diags)){</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(diags[[i]])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-2.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-3.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-4.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-5.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-6.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-7.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-8.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-9.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-10.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-11.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-12.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-13.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-14.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-15.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-16.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-17.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-18.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-19.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-20.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-21.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-22.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-23.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-24.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-25.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-26.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-27.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-28.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-29.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-5-30.png" width="864" style="display: block; margin: auto;" /> Après vérification des figures diagnostiques, j’en conclus que chaque régression satisfait aux prémisses d’un modèle de régression linéaire simple.</p>
<p>Maintenant, je vais créer un jeu <code>lw</code> que je vais pouvoir utiliser plus bas.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fichier de base que je dois remplir</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">annee =</span> my_year, <span class="at">mois =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">ifelse</span>(mois <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>), <span class="st">&quot;hivernal&quot;</span>, <span class="st">&quot;estival&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(annee, mois)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>lw</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 336 x 3</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">##    annee  mois type    </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;   </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1993     1 hivernal</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1993     2 hivernal</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1993     3 hivernal</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1993     4 estival </span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1993     5 estival </span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1993     6 estival </span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1993     7 estival </span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1993     8 estival </span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1993     9 estival </span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  1993    10 hivernal</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 326 more rows</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lw, rels, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;annee&quot;</span>, <span class="st">&quot;type&quot;</span>))</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(lw, <span class="fu">is.na</span>(n_brute))) <span class="co"># lignes où le merge n&#39;a pas fonctionné</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(cor) <span class="co"># 156 lignes</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 156</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(lw<span class="sc">$</span>type[cor]) </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;hivernal&quot;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour ces lignes, on aurait voulu les données du Gadus, mais elles n&#39;existent pas.</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># On prend donc les coefficients de la régression estival à la place</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lw) <span class="co"># 336 obs et 9 var</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 336   9</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lw, rels <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;estival&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>type), <span class="at">by =</span> <span class="st">&quot;annee&quot;</span>)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lw) <span class="co"># 336 obs et 15 var</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 336  15</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>n_brute.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>n_brute.y[cor]</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>n_net.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>n_net.y[cor]</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>intercept.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>intercept.y[cor]</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>slope.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>slope.y[cor]</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>r_squared.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>r_squared.y[cor]</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>lw<span class="sc">$</span>source.x[cor] <span class="ot">&lt;-</span> lw<span class="sc">$</span>source.y[cor]</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>lw[, <span class="fu">c</span>(<span class="st">&quot;n_brute.y&quot;</span>, <span class="st">&quot;n_net.y&quot;</span>, <span class="st">&quot;intercept.y&quot;</span>, <span class="st">&quot;slope.y&quot;</span>, <span class="st">&quot;r_squared.y&quot;</span>, <span class="st">&quot;source.y&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># rendu inutile</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lw) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.x&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">names</span>(lw))</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(lw, <span class="fu">is.na</span>(n_brute))); <span class="fu">length</span>(cor) <span class="co"># 0 ligne = tout est beau.</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cor, rels)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lw) <span class="co"># 336 obs et 9 var</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 336   9</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(lw, <span class="at">file =</span> dat_lw)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>lw</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 336 x 9</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="do">##    annee  mois type     n_brute n_net intercept slope r_squared source </span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  1993     1 hivernal    1097  1000     -12.2  3.13     0.995 RH 1993</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1993     2 hivernal    1097  1000     -12.2  3.13     0.995 RH 1993</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1993     3 hivernal    1097  1000     -12.2  3.13     0.995 RH 1993</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1993     4 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1993     5 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1993     6 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1993     7 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  1993     8 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1993     9 estival      477   449     -12.0  3.10     0.99  RE 1993</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  1993    10 hivernal    1097  1000     -12.2  3.13     0.995 RH 1993</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 326 more rows</span></span></code></pre></div>
</div>
<div id="préparation-des-données" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Préparation des données</h1>
<div id="échantillonneurs-à-quai" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Échantillonneurs à quai</h2>
<div id="fl" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> FL</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ouverture</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(dat_LF); <span class="fu">dim</span>(lf) <span class="co"># 137136 obs et 38 var</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 137136     38</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables d&#39;intérêt, bonnes années, pas d&#39;outliers</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="ot">&lt;-</span> lf <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(annee <span class="sc">%in%</span> my_year, outlier <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(annee, mois, opano, engin, longueur, n_mes, ech_id, source)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 8 var</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     8</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Regroupements d&#39;engins</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(dat_engin_obs); <span class="fu">dim</span>(engins_obs) <span class="co"># 18 obs et 5 var</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 18  5</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>engins_obs</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 18 x 5</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">##    engin source      engin_fr                  engin_en             engin_groupe</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;                     &lt;chr&gt;                &lt;ord&gt;       </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 LL    quai        Palangres (non spécifiée~ Longlines (not spec~ Longlines   </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 LLS   quai        Palangres calées          Set longlines        Longlines   </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 GN    quai        Filets maillants (non sp~ Gillnets (not speci~ Gillnets    </span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 LX    quai        Hameçons et lignes (non ~ Hooks and lines (no~ Hand gear   </span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 OTB2  quai        Chalut de fond à panneau~ Stern otter trawl    Other trawls</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 OTM   quai        Chalut pélagique          Midwater trawl       Other trawls</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 FIX   quai        Pièges (non spécifiés)    Traps (not specifie~ Traps       </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 GNS   quai        Filets maillants calés (~ Set gillnets (ancho~ Gillnets    </span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 LHP   quai        Lignes à main et lignes ~ Handlines and pole-~ Hand gear   </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 PS    quai        Seine bourse              Purse seine          Seines      </span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 SDN   quai        Seine danoise ou écossai~ Danish or Scottish ~ Seines      </span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 LLG   quai        Palangrotte               Handline             Hand gear   </span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 FPN   quai        Filets-pièges fixes non ~ Stationary uncovere~ Traps       </span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 OTB2  observateur Chalut de fond à panneau~ Stern otter trawl    Shrimp traw~</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 GRL1  observateur Chalut à crevettes (de c~ Shrimp trawl (side)~ Shrimp traw~</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 GRL2  observateur Chalut à crevettes (arri~ Shrimp trawl (stern~ Shrimp traw~</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 TT    observateur Chalut double             Twin trawl           Shrimp traw~</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 GRL   observateur Chalut à crevettes (non ~ Shrimp trawl (unspe~ Shrimp traw~</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 8 var</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     8</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lf_caa, engins_obs <span class="sc">%&gt;%</span> <span class="fu">select</span>(source, engin, engin_groupe), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;source&quot;</span>, <span class="st">&quot;engin&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">engin_groupe =</span> <span class="fu">as.character</span>(engin_groupe)) <span class="co"># je ne veux pas des facteurs</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 9 var</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     9</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(lf_caa<span class="sc">$</span>engin_groupe, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># parfait.</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="do">##      Gillnets     Hand gear     Longlines  Other trawls        Seines </span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="do">##         20263          3692         21299          1635          1077 </span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Shrimp trawls         Traps          &lt;NA&gt; </span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="do">##          7640          1664             0</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co"># zones unitaires de l&#39;OPANO</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 9 var</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     9</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;4R|4S|3Pn&quot;</span>, opano))</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 9 var</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     9</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(lf_caa<span class="sc">$</span>opano) <span class="co"># les valeurs à 2 caractères (4R et 4S) sont des zones unitaires vagues (quelque part dans 4R ou 4S)</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;3Pn&quot; &quot;4R&quot;  &quot;4Ra&quot; &quot;4Rb&quot; &quot;4Rc&quot; &quot;4Rd&quot; &quot;4S&quot;  &quot;4Si&quot; &quot;4Ss&quot; &quot;4Sv&quot; &quot;4Sw&quot; &quot;4Sx&quot;</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &quot;4Sy&quot; &quot;4Sz&quot;</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Recalcul du poids de l&#39;échantillon</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 9 var</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270     9</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(lf_caa, lw <span class="sc">%&gt;%</span> <span class="fu">select</span>(annee, mois, intercept, slope), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;annee&quot;</span>, <span class="st">&quot;mois&quot;</span>))</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lf_caa) <span class="co"># 57270 obs et 11 var</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 57270    11</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>lf_caa<span class="sc">$</span>weight.unit <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">with</span>(lf_caa, intercept <span class="sc">+</span> slope <span class="sc">*</span> <span class="fu">log</span>(longueur))) <span class="co"># la longueur est déjà en cm. donne le pds en kg</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lf_caa<span class="sc">$</span>weight.unit) <span class="co"># aucune valeur NA = parfait</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.00044  0.89102  1.62861  1.96531  2.57903 31.92444</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = lf_caa, aes(x = longueur, y = weight.unit)) +</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(color = &quot;red&quot;, alpha = 0.25) +</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = &quot;Longueur (mm)&quot;, y = &quot;Masse (kg)&quot;)</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>lf_caa[, <span class="fu">c</span>(<span class="st">&quot;intercept&quot;</span>, <span class="st">&quot;slope&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># rendu inutile</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Classe de longueur: les longueurs sont déjà prises au cm près. je laisse ainsi</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomme les colonnes (pour que les noms concordent avec ce que EVB utilise)</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lf_caa) <span class="ot">&lt;-</span> <span class="fu">recode</span>(<span class="fu">names</span>(lf_caa), <span class="st">&quot;opano&quot;</span> <span class="ot">=</span> <span class="st">&quot;region&quot;</span>, <span class="st">&quot;engin_groupe&quot;</span> <span class="ot">=</span> <span class="st">&quot;gear&quot;</span>, </span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;mois&quot;</span> <span class="ot">=</span> <span class="st">&quot;period&quot;</span>, <span class="st">&quot;annee&quot;</span> <span class="ot">=</span> <span class="st">&quot;year&quot;</span>, <span class="st">&quot;longueur&quot;</span> <span class="ot">=</span> <span class="st">&quot;length&quot;</span>, </span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;n_mes&quot;</span> <span class="ot">=</span> <span class="st">&quot;n&quot;</span>, <span class="st">&quot;ech_id&quot;</span> <span class="ot">=</span> <span class="st">&quot;sample.id&quot;</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, period, region, gear, sample.id, length, weight.unit, n, source) </span></code></pre></div>
<p>Je peux maintenant sauvegarder.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(lf_caa, <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_lf_caa.Rda&quot;</span>))</span></code></pre></div>
</div>
<div id="données-biologiques" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Données biologiques</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(dat_bio); <span class="fu">dim</span>(bio) <span class="co"># 105098 obs et 26 var</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 105098     26</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bio) <span class="ot">&lt;-</span> <span class="fu">recode</span>(<span class="fu">names</span>(bio), <span class="st">&quot;annee&quot;</span> <span class="ot">=</span> <span class="st">&quot;year&quot;</span>, <span class="st">&quot;mois&quot;</span> <span class="ot">=</span> <span class="st">&quot;month&quot;</span>, <span class="st">&quot;opano&quot;</span> <span class="ot">=</span> <span class="st">&quot;region&quot;</span>, <span class="st">&quot;engin&quot;</span> <span class="ot">=</span> <span class="st">&quot;gear&quot;</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;longueur&quot;</span> <span class="ot">=</span> <span class="st">&quot;length&quot;</span>, <span class="st">&quot;ech_id&quot;</span> <span class="ot">=</span> <span class="st">&quot;sample.id&quot;</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>bio_caa <span class="ot">&lt;-</span> bio <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(year <span class="sc">%in%</span> my_year, outlier <span class="sc">==</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">select</span>(year, month, region, gear, length, age, sample.id, source) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>           as_tibble</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bio_caa) <span class="co"># 47294 obs et 8 var</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 47294     8</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>bio_caa</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 47,294 x 8</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="do">##     year month region gear  length   age sample.id source</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;chr&gt; </span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  2011     7 4Sw    GNS       66     7     50722 quai  </span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1994     5 4Rc    LLS       43     5       346 quai  </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  2014     7 4Sw    GNS       54     7     56116 quai  </span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  1995     8 4Sv    GN        71    11      1654 quai  </span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  1995     8 4Sw    GN        38     4      1825 quai  </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  1995    10 4Sw    GN        43     5      2111 quai  </span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  2019     8 4Si    GNS       61     7     64223 quai  </span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  2001    10 4Rc    LLS       53     7     15705 quai  </span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  1997     7 4Sw    GN        89    10      8296 quai  </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  2002     8 4Sw    GNS       51     6     16168 quai  </span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 47,284 more rows</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bio_caa<span class="sc">$</span>age) <span class="co"># toutes les âges sont plausibles</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="do">##    0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15 </span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="do">##   72 1516 3274 3982 5280 5424 6749 6397 5667 4080 2415 1304  605  322  112   66 </span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="do">##   16   17   18 </span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="do">##   20    8    1</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bio_caa<span class="sc">$</span>month, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># parfait</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="do">##     1     2     3     4     5     6     7     8     9    10    11    12  &lt;NA&gt; </span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="do">##   301    55   129   430  1869  2166  8773 24557  3563  3406  1308   737     0</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Région d&#39;où proviennent les échantillons</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(bio_caa<span class="sc">$</span>region) <span class="co"># les valeurs à 2 caractères (4R et 4S) sont des zones unitaires vagues (quelque part dans 4R ou 4S)</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;4Sw&quot; &quot;4Rc&quot; &quot;4Sv&quot; &quot;4Si&quot; &quot;4Sx&quot; &quot;4Rd&quot; &quot;4Ss&quot; &quot;4Sz&quot; &quot;4Rb&quot; &quot;4S&quot;  &quot;3Pn&quot; &quot;4Sy&quot;</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &quot;4R&quot;  &quot;4Ra&quot; NA</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>bio_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(region)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(source) <span class="sc">%&gt;%</span> unique <span class="co"># les valeurs de région NA sont issues des données du</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;nGSL&quot;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co"># relevé nGSL</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Regroupements d&#39;engins</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bio_caa) <span class="co"># 47294 obs et 8 var</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 47294     8</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>bio_caa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(bio_caa, engins_obs <span class="sc">%&gt;%</span> <span class="fu">select</span>(source, engin, engin_groupe), </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;gear&quot;</span> <span class="ot">=</span> <span class="st">&quot;engin&quot;</span>, <span class="st">&quot;source&quot;</span> <span class="ot">=</span> <span class="st">&quot;source&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">engin_groupe =</span> <span class="fu">as.character</span>(engin_groupe)) <span class="co"># je ne veux pas des facteurs</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(bio_caa) <span class="co"># 47294 obs et 9 var</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 47294     9</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(bio_caa<span class="sc">$</span>engin_groupe, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># problème.</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="do">##     Gillnets    Hand gear    Longlines Other trawls       Seines        Traps </span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="do">##         9914          648        14500          914          866          539 </span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="do">##         &lt;NA&gt; </span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="do">##        19913</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>bio_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(engin_groupe)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(source) <span class="sc">%&gt;%</span> unique <span class="co"># problème de merge</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;nGSL&quot;</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a><span class="co"># engins_obs contient les engins utilés dans les données d&#39;observateurs en mer</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(bio_caa, source <span class="sc">==</span> <span class="st">&quot;nGSL&quot;</span>)); <span class="fu">length</span>(cor) <span class="co"># 19913 lignes</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 19913</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(bio_caa<span class="sc">$</span>engin_groupe[cor]) <span class="co"># NA pour l&#39;instant</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] NA</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>bio_caa<span class="sc">$</span>engin_groupe[cor] <span class="ot">&lt;-</span> <span class="st">&quot;Shrimp trawls&quot;</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cor)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>bio_caa<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># inutile maintenant</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Classe de longueur: les longueurs sont déjà prises au cm près. je laisse ainsi</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Renomme les colonnes (pour que les noms concordent avec ce que EVB utilise)</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(bio_caa) <span class="ot">&lt;-</span> <span class="fu">recode</span>(<span class="fu">names</span>(bio_caa), <span class="st">&quot;engin_groupe&quot;</span> <span class="ot">=</span> <span class="st">&quot;gear&quot;</span>, <span class="st">&quot;month&quot;</span> <span class="ot">=</span> <span class="st">&quot;period&quot;</span>)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>bio_caa <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, period, region, gear, sample.id, length, age, source)</span></code></pre></div>
<p>Je peux maintenant sauvegarder.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(bio_caa, <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_bio_caa.Rda&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="débarquements" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Débarquements</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(dat_catch); <span class="fu">dim</span>(catch) <span class="co"># 593461 obs et 13 var</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 593461     13</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(catch) <span class="ot">&lt;-</span> <span class="fu">recode</span>(<span class="fu">names</span>(catch), <span class="st">&quot;annee&quot;</span> <span class="ot">=</span> <span class="st">&quot;year&quot;</span>, <span class="st">&quot;mois&quot;</span> <span class="ot">=</span> <span class="st">&quot;period&quot;</span>, <span class="st">&quot;opano&quot;</span> <span class="ot">=</span> <span class="st">&quot;region&quot;</span>, <span class="st">&quot;engin&quot;</span> <span class="ot">=</span> <span class="st">&quot;gear&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>catch <span class="ot">&lt;-</span> catch <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> my_year) <span class="sc">%&gt;%</span> <span class="fu">select</span>(year, period, region, gear, catch)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(catch) <span class="co"># 331398 obs et 5 var</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 331398      5</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Regroupements d&#39;engins</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(catch) <span class="co"># 331398 obs et 5 var</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 331398      5</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(dat_engin_deb) <span class="co"># engins_deb</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>catch <span class="ot">&lt;-</span> <span class="fu">left_join</span>(catch, engins_deb <span class="sc">%&gt;%</span> <span class="fu">select</span>(engin, engin_groupe), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;gear&quot;</span> <span class="ot">=</span> <span class="st">&quot;engin&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">gear =</span> engin_groupe) <span class="sc">%&gt;%</span> </span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(<span class="sc">-</span>engin_groupe)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(catch) <span class="co"># 331398 obs et 5 var</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 331398      5</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(catch<span class="sc">$</span>gear, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># 0 valeurs NA = parfait.</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="do">##    Shrimp trawls     Other trawls           Seines         Gillnets </span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="do">##             1767             8351             4514           163975 </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="do">##        Longlines        Hand gear            Traps Others / unknown </span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="do">##           112523            36221             3936              111 </span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="do">##             &lt;NA&gt; </span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="do">##                0</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co"># total catch by level</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>catch_caa <span class="ot">&lt;-</span> catch <span class="sc">%&gt;%</span> </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(year, region, period, gear) <span class="sc">%&gt;%</span> <span class="co"># regroupe par strate</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>             <span class="fu">summarise</span>(<span class="at">catch =</span> <span class="fu">sum</span>(catch, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>             ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(catch <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span>  <span class="co"># pour une raison inconnue, on pouvait avoir des strates avec 0 kg débarqué...</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>(year, period, region, gear, catch) <span class="sc">%&gt;%</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">gear =</span> <span class="fu">as.character</span>(gear)) <span class="co"># je ne veux pas des facteurs</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(catch_caa) <span class="co"># 4591 obs et 5 var</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4591    5</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;fr&quot;</span>){</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  misc <span class="ot">&lt;-</span> <span class="st">&quot;Autres / inconnus&quot;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  misc <span class="ot">&lt;-</span> <span class="st">&quot;Others / unknown&quot;</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(catch_caa, gear <span class="sc">==</span> misc)); <span class="fu">length</span>(cor)  <span class="co"># 49 strates où l&#39;engin est &quot;Autres / inconnus&quot;</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 49</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les besoins de la cause, je remplace par NA. get.samples() comprendra que je veux qu&#39;il cherche dans tous les types d&#39;engins</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>catch_caa<span class="sc">$</span>gear[cor] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(catch_caa, <span class="at">file =</span>  <span class="fu">paste0</span>(result, <span class="st">&quot;03_catch_caa.Rda&quot;</span>))</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(cor)</span></code></pre></div>
<p>Les données de débarquements sont en kg.</p>
</div>
</div>
<div id="calculs-à-lâge" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Calculs à l’âge</h1>
<div id="sélection-des-échantillons" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Sélection des échantillons</h2>
<p>Je fais le calcul en 2 étapes: - Strates associées aux chaluts à crevettes - Autres strates (celles dont l’engin n’est pas le chalut à crevette)</p>
<p>La raison est que je ne veux utiliser les données des observateurs à quai / relevé nGSL <strong>QUE</strong> pour ces strates et pas les autres.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dat_caa_raw)){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Strates avec chalut à crevettes</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  intrant_catch <span class="ot">&lt;-</span> catch_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span>) <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  intrant_lf <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span>, source <span class="sc">==</span> <span class="st">&quot;observateur&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                as.data.frame</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  intrant_bio <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">filter</span>(gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span>, source <span class="sc">==</span> <span class="st">&quot;nGSL&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                 as.data.frame</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  caa_all_crev <span class="ot">&lt;-</span> <span class="fu">get.samples</span>(<span class="at">catch =</span> intrant_catch, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lf =</span> intrant_lf, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">al =</span> intrant_bio, </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.lf.samples =</span> <span class="dv">2</span>, <span class="co"># min samples for length-frequency</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.al.samples =</span> <span class="dv">1</span>, <span class="co"># min samples for age-length key. Différent ici puisque les âges de nGSL</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                              <span class="co"># sont vues comme un seul échantillon...</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.al.fish =</span> <span class="dv">100</span>, <span class="co"># min number of fish required in alk</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                              <span class="at">period.unit =</span> <span class="st">&quot;month&quot;</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prob.al =</span> <span class="fl">0.95</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subsample =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                  as_tibble</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(caa_all_crev) <span class="co"># 3575 obs et 36 var</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(caa_all_crev<span class="sc">$</span>option.lengthfreq, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># ok</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(caa_all_crev<span class="sc">$</span>option.agelength, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># toujours 9, 10 ou 11</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Autres strates</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">with</span>(catch_caa, gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(gear))); <span class="fu">length</span>(cor) <span class="co"># 4484 strates</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  intrant_catch <span class="ot">&lt;-</span> catch_caa[cor, ] <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  intrant_lf <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">!=</span> <span class="st">&quot;observateur&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  intrant_bio <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">!=</span> <span class="st">&quot;nGSL&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source) <span class="sc">%&gt;%</span> as.data.frame</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  caa_all_aut <span class="ot">&lt;-</span> <span class="fu">get.samples</span>(<span class="at">catch =</span> intrant_catch, </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lf =</span> intrant_lf, </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>                              <span class="at">al =</span> intrant_bio, </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.lf.samples =</span> <span class="dv">2</span>, <span class="co"># min samples for length-frequency</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.al.samples =</span> <span class="dv">2</span>, <span class="co"># min samples for age-length key</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>                              <span class="at">min.al.fish =</span> <span class="dv">100</span>, <span class="co"># min number of fish required in alk</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                              <span class="at">period.unit =</span> <span class="st">&quot;month&quot;</span>,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prob.al =</span> <span class="fl">0.95</span>,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>                              <span class="at">subsample =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>                  as_tibble</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(caa_all_aut) <span class="co"># 226241 obs et 36 var</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(caa_all_aut<span class="sc">$</span>option.lengthfreq, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># ok</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(caa_all_aut<span class="sc">$</span>option.agelength, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>) <span class="co"># ok</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combinaison</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  val_max <span class="ot">&lt;-</span> <span class="fu">max</span>(caa_all_aut<span class="sc">$</span>id); val_max</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  caa_all_crev <span class="ot">&lt;-</span> caa_all_crev <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> id <span class="sc">+</span> val_max) <span class="co"># pour ne pas avoir de doublons d&#39;ids</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  caa_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(caa_all_aut, caa_all_crev)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(caa_all) <span class="co"># 229816 obs et 38 var</span></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">n_distinct</span>(caa_all<span class="sc">$</span>id) <span class="sc">==</span> <span class="fu">nrow</span>(catch_caa) <span class="co"># vrai</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  ids <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;age.&quot;</span>, <span class="fu">names</span>(caa_all)); ids</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  caa_all <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate_at</span>(<span class="at">.vars =</span> ids, <span class="at">.funs =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)) <span class="co"># à cause du bind_rows</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(caa_all, <span class="at">file =</span> dat_caa_raw)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(caa_all_aut, caa_all_crev, ids)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(dat_caa_raw)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(caa_all) <span class="co"># 229816 obs et 38 var </span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 229816     38</span></span></code></pre></div>
</div>
<div id="calculs-à-lâge-1" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Calculs à l’âge</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(dat_caa_processed)){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1) Calculs à l&#39;âge avec le groupe+ (pour caan seulement)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  caa <span class="ot">&lt;-</span> <span class="fu">get.caa</span>(<span class="at">x =</span> caa_all, <span class="at">plus =</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span> as_tibble <span class="co"># on utilise un groupe d&#39;âge 13+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(caa) <span class="co"># 392 obs et 8 var</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">with</span>(caa, age <span class="sc">==</span> <span class="dv">13</span>)); <span class="fu">length</span>(cor) <span class="co"># 28 lignes</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  caa<span class="sc">$</span>age[cor] <span class="ot">&lt;-</span> <span class="st">&quot;13+&quot;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2) Calculs à l&#39;âge sans le groupe+ (pour les autres mesures)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  caa2 <span class="ot">&lt;-</span> <span class="fu">get.caa</span>(<span class="at">x =</span> caa_all) <span class="sc">%&gt;%</span> as_tibble</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(caa2) <span class="co"># 532 obs et 8 var</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3) Combinaison</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  caa <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;avec_plus&quot;</span> <span class="ot">=</span> caa, <span class="st">&quot;sans_plus&quot;</span> <span class="ot">=</span> caa2) <span class="co"># dans une liste pour éviter la confusion</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(caa, <span class="at">file =</span>  dat_caa_processed)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(caa2, bio, catch, engins_deb, engins_obs, lf, intrant_catch, intrant_lf, intrant_bio)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(dat_caa_processed)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>caa<span class="sc">$</span>avec_plus <span class="sc">%&gt;%</span> dim <span class="co"># 392 obs et 8 var</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 392   8</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>caa<span class="sc">$</span>sans_plus <span class="sc">%&gt;%</span> dim <span class="co"># 532 obs et 8 var</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 532   8</span></span></code></pre></div>
</div>
</div>
<div id="exemple-pour-le-resdoc" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Exemple pour le resdoc</h1>
<p>J’y vais avec la strate: <em>2005–June–4Rb–Gillnet</em>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>catch <span class="ot">&lt;-</span> catch_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2005</span>, period <span class="sc">==</span> <span class="dv">6</span>, region <span class="sc">==</span> <span class="st">&quot;4Rb&quot;</span>, gear <span class="sc">==</span> <span class="st">&quot;Gillnets&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> catch<span class="sc">$</span>catch; C</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1393</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> catch<span class="sc">$</span>year; y</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2005</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> catch<span class="sc">$</span>period; p</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 6</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> catch<span class="sc">$</span>region; r</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;4Rb&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> catch<span class="sc">$</span>gear; g</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;Gillnets&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>find.samples <span class="ot">&lt;-</span> <span class="cf">function</span>(df,o,y,p,r,g,period.unit){</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">with</span>(df, <span class="fu">ymd</span>(<span class="fu">paste</span>(year, period, <span class="st">&#39;01&#39;</span>)))</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  d  <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="fu">paste</span>(y, p, <span class="st">&#39;01&#39;</span>)) <span class="co"># date (for semesters this will be month 1 to 4, but that doesn&#39;t matter)</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  dn <span class="ot">&lt;-</span> d <span class="co"># neigbouring dates. If no period data, all periods of the same year are allowed  (so option 1 and 2 are the same)</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(p) <span class="sc">==</span> <span class="dv">1</span>){            <span class="co"># If period data; normal way</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    dn <span class="ot">&lt;-</span> d <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="co"># neigbouring dates</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (period.unit <span class="sc">==</span> <span class="st">&#39;quarter&#39;</span>){    <span class="co"># cheat and replace december with last quarter</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(dn[<span class="fu">which</span>(<span class="fu">month</span>(dn) <span class="sc">==</span> <span class="dv">12</span>)]) <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    }       </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  pn <span class="ot">&lt;-</span> <span class="fu">month</span>(dn)       <span class="co"># neigbouring periods</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  yn <span class="ot">&lt;-</span> y <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># neigbouring years</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(<span class="fu">as.character</span>(o), </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;1&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, date <span class="sc">%in%</span> d  <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g <span class="sc">&amp;</span> region <span class="sc">%in%</span> r)},</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;2&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, date <span class="sc">%in%</span> dn <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g <span class="sc">&amp;</span> region <span class="sc">%in%</span> r)},</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;3&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, date <span class="sc">%in%</span> d  <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)},                 </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;4&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, date <span class="sc">%in%</span> dn <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)}, </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;5&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> y <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)}, </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;6&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> y)}, </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;7&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn <span class="sc">&amp;</span> period <span class="sc">%in%</span> p  <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g <span class="sc">&amp;</span> region <span class="sc">%in%</span> r)}, </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;8&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn <span class="sc">&amp;</span> period <span class="sc">%in%</span> pn <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g <span class="sc">&amp;</span> region <span class="sc">%in%</span> r)}, </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;9&#39;</span>  <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn <span class="sc">&amp;</span> period <span class="sc">%in%</span> p  <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)},</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;10&#39;</span> <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn <span class="sc">&amp;</span> period <span class="sc">%in%</span> pn <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)},</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;11&#39;</span> <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn <span class="sc">&amp;</span> gear <span class="sc">%in%</span> g)},</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>         <span class="st">&#39;12&#39;</span> <span class="ot">=</span> {id <span class="ot">&lt;-</span> <span class="fu">with</span>(df, year <span class="sc">%in%</span> yn)})</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(id)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>lf <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source)</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>al <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>source)</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>period.unit <span class="ot">&lt;-</span> <span class="st">&quot;month&quot;</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>cacol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;year&#39;</span>, <span class="st">&#39;period&#39;</span>, <span class="st">&#39;region&#39;</span>, <span class="st">&#39;gear&#39;</span>, <span class="st">&#39;catch&#39;</span>) <span class="co"># required columns in catch</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>lfcol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;year&#39;</span>, <span class="st">&#39;period&#39;</span>, <span class="st">&#39;region&#39;</span>, <span class="st">&#39;gear&#39;</span>, <span class="st">&#39;sample.id&#39;</span>, <span class="st">&#39;length&#39;</span>, <span class="st">&#39;weight.unit&#39;</span>, <span class="st">&#39;n&#39;</span>) <span class="co"># required columns in lf</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>alcol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;year&#39;</span>, <span class="st">&#39;period&#39;</span>, <span class="st">&#39;region&#39;</span>, <span class="st">&#39;gear&#39;</span>, <span class="st">&#39;sample.id&#39;</span>, <span class="st">&#39;length&#39;</span>, <span class="st">&#39;age&#39;</span>) <span class="co"># required columns in al</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche LF</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Niveau 1</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>o.lf <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">find.samples</span>(lf,o.lf,y,p,r,g,period.unit) <span class="co"># find samples according to step o</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>this.lf <span class="ot">&lt;-</span> lf[id, ] <span class="co"># select them</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>n.lf <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(this.lf[,lfcol[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])); n.lf <span class="co"># count unique samples </span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Pas assez d&#39;échantillon, vais au niveau 2</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Niveau 2</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>o.lf <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">find.samples</span>(lf,o.lf,y,p,r,g,period.unit) <span class="co"># find samples according to step o</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>this.lf <span class="ot">&lt;-</span> lf[id, ] <span class="co"># select them</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>n.lf <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(this.lf[,lfcol[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])); n.lf <span class="co"># count unique samples </span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 15</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 15 échantillons. Reste au niveau 2.</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(this.lf<span class="sc">$</span>n) <span class="co"># 2306 poissons mesurés pour la FL</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2306</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Création de la clé âge-longueur globale</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>alg <span class="ot">&lt;-</span> <span class="fu">table</span>(al<span class="sc">$</span>length,al<span class="sc">$</span>age)</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>alg <span class="ot">&lt;-</span> <span class="fu">prop.table</span>(alg,<span class="dv">1</span>)</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>alg <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">length=</span><span class="fu">as.numeric</span>(<span class="fu">rownames</span>(alg)),<span class="fu">data.frame</span>(<span class="fu">rbind</span>(alg)))</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>le <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">length =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="fu">c</span>(alg<span class="sc">$</span>length, lf<span class="sc">$</span>length)), <span class="fu">max</span>(<span class="fu">c</span>(alg<span class="sc">$</span>length, lf<span class="sc">$</span>length)), <span class="fu">min</span>(<span class="fu">diff</span>(alg<span class="sc">$</span>length))))</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>alg <span class="ot">&lt;-</span> <span class="fu">merge</span>(le,alg)</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>fill.multinom <span class="ot">&lt;-</span> <span class="cf">function</span>(df, acol, lcol, <span class="at">id=</span><span class="cn">NULL</span>, <span class="at">smooth=</span><span class="cn">FALSE</span>){</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a>    alen <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[,acol,<span class="at">drop=</span><span class="cn">FALSE</span>])</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a>    len  <span class="ot">&lt;-</span> df[,lcol]</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">ncol</span>(alen) <span class="sc">==</span> <span class="dv">1</span>){ <span class="co"># if there is only one age class than the likelihood is always 1??</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a>        new <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(alen))</span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste0</span>(<span class="st">&#39;** for catch stratum &#39;</span>, id, <span class="st">&#39; only one age class was found **&#39;</span>))</span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{ <span class="co"># model if there are multiple age classes</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a>        m <span class="ot">&lt;-</span> <span class="fu">multinom</span>(alen<span class="sc">~</span>len, <span class="at">trace =</span> F, <span class="at">maxit =</span> <span class="dv">1500</span>)</span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (m<span class="sc">$</span>convergence <span class="sc">!=</span> <span class="dv">0</span>) <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">&#39;** Non-convergence when filling gaps for id&#39;</span>, id))</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a>        new <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">len =</span> df<span class="sc">$</span>length), <span class="at">type =</span> <span class="st">&quot;probs&quot;</span>) <span class="co"># predictions for all lengths found in df</span></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a>        new <span class="ot">&lt;-</span> <span class="fu">round</span>(new, <span class="dv">3</span>) <span class="co"># acceptable precision level (to avoid 0.0000001 % chances of absurd age-length combos)</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># replace onle NAs or everything by predictions</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(smooth){</span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a>        df[, acol] <span class="ot">&lt;-</span> new</span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a>        df[, acol][<span class="fu">is.na</span>(df[, acol])] <span class="ot">&lt;-</span> new[<span class="fu">is.na</span>(df[, acol])]</span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>alg <span class="ot">&lt;-</span> <span class="fu">fill.multinom</span>(<span class="at">df =</span> alg, <span class="at">acol =</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(alg), <span class="at">lcol =</span> <span class="dv">1</span>, <span class="at">id=</span><span class="st">&#39;global&#39;</span>, <span class="at">smooth =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche Age</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Niveau 1</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a>o.al <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">find.samples</span>(al,o.al,y,p,r,g,period.unit)</span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a>this.al <span class="ot">&lt;-</span> al[id,] <span class="co"># select them</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a>n.al <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(this.al[,alcol[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])); n.al <span class="co"># count unique samples</span></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Pas assez d&#39;échantillon, vais au niveau 2</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Niveau 2</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a>o.al <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">find.samples</span>(al,o.al,y,p,r,g,period.unit)</span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a>this.al <span class="ot">&lt;-</span> al[id,] <span class="co"># select them</span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a>n.al <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">unique</span>(this.al[,alcol[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]])); n.al <span class="co"># 12 échantillons = critère 1 ok</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 12</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a>f.al <span class="ot">&lt;-</span> <span class="fu">nrow</span>(this.al); f.al <span class="co"># 227 poissons, critère 2 ok</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 227</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="co"># Tableau pour le resdoc</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> this.lf <span class="sc">%&gt;%</span> </span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(length) <span class="sc">%&gt;%</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">n_fl =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">left_join</span>(., this.al <span class="sc">%&gt;%</span> </span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">group_by</span>(length) <span class="sc">%&gt;%</span> </span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">summarise</span>(<span class="at">n_al =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>                     ungroup, <span class="at">by =</span> <span class="st">&quot;length&quot;</span>) </span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Longueurs ne nécessitant pas alg</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a>avec <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(n_al)); avec</span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 49 x 3</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a><span class="do">##    length  n_fl  n_al</span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a><span class="do">##  1     49     1     1</span></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a><span class="do">##  2     50     4     3</span></span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="do">##  3     51    17     8</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="do">##  4     52    17     6</span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="do">##  5     53    30     5</span></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="do">##  6     54    42     1</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a><span class="do">##  7     55    70     9</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a><span class="do">##  8     56    96     8</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="do">##  9     57    98     6</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="do">## 10     58   136     3</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 39 more rows</span></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>alk <span class="ot">&lt;-</span> this.al <span class="sc">%&gt;%</span> </span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(length, age) <span class="sc">%&gt;%</span> </span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>       count <span class="sc">%&gt;%</span> </span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(length) <span class="sc">%&gt;%</span> </span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a>       ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a>       <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;length&quot;</span>, <span class="at">names_from =</span> <span class="st">&quot;age&quot;</span>, <span class="at">names_prefix =</span> <span class="st">&quot;X&quot;</span>, <span class="at">values_from =</span> prop)</span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a>alk</span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 49 x 12</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a><span class="do">##    length     X5     X4     X6     X7     X8     X9    X11   X10   X14   X12</span></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a><span class="do">##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a><span class="do">##  1     49  1     NA     NA     NA     NA     NA     NA        NA    NA    NA</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="do">##  2     50  0.667  0.333 NA     NA     NA     NA     NA        NA    NA    NA</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a><span class="do">##  3     51  0.25   0.125  0.375  0.25  NA     NA     NA        NA    NA    NA</span></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a><span class="do">##  4     52  0.333 NA      0.167  0.333  0.167 NA     NA        NA    NA    NA</span></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a><span class="do">##  5     53 NA     NA     NA      0.6    0.2    0.2   NA        NA    NA    NA</span></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a><span class="do">##  6     54 NA     NA     NA      1     NA     NA     NA        NA    NA    NA</span></span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="do">##  7     55  0.111 NA      0.111  0.333 NA      0.444 NA        NA    NA    NA</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="do">##  8     56 NA     NA      0.125  0.625  0.125 NA      0.125    NA    NA    NA</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a><span class="do">##  9     57 NA     NA     NA      0.833  0.167 NA     NA        NA    NA    NA</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="do">## 10     58 NA     NA     NA      0.667 NA     NA      0.333    NA    NA    NA</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 39 more rows, and 1 more variable: X13 &lt;dbl&gt;</span></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a>avec <span class="ot">&lt;-</span> <span class="fu">left_join</span>(avec, alk, <span class="at">by =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Longueurs nécessitant alg</span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a>manque <span class="ot">&lt;-</span> temp <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(n_al)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n_al =</span> <span class="dv">0</span>); manque</span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 1 x 3</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a><span class="do">##   length  n_fl  n_al</span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="do">## 1     27     8     0</span></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a>manque <span class="ot">&lt;-</span> <span class="fu">left_join</span>(manque, alg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(length <span class="sc">==</span> <span class="dv">27</span>), <span class="at">by =</span> <span class="st">&quot;length&quot;</span>)</span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(manque <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">as.character</span>(length)), <span class="co"># 1ère longueur</span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a>                    avec[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, ] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">as.character</span>(length)), <span class="co"># 7 autres longueur</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tibble</span>(<span class="at">length =</span> <span class="st">&quot;...&quot;</span>),  <span class="co"># pour montrer que la table est bcp plus longue</span></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a>                    avec[<span class="fu">nrow</span>(avec), ] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">as.character</span>(length))) <span class="sc">%&gt;%</span> <span class="co"># dernière longueur</span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">.funs =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="st">&quot;&quot;</span>, x)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="dv">4</span><span class="sc">:</span><span class="fu">ncol</span>(.), </span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.funs =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x)<span class="sc">|</span>x <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;&quot;</span>, </span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a>                                               <span class="fu">format</span>(x, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">nsmall =</span> <span class="dv">3</span>, <span class="at">decimal.mark =</span> dm)))</span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a>ages_alk <span class="ot">&lt;-</span> this.al <span class="sc">%&gt;%</span> <span class="fu">pull</span>(age) <span class="sc">%&gt;%</span> sort <span class="sc">%&gt;%</span> unique; ages_alk <span class="co"># âges déjà dans la clé âge-longueur</span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  4  5  6  7  8  9 10 11 12 13 14</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a>ages_alg <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(alg) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, .) <span class="sc">%&gt;%</span> .[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(.)], ages_alk); ages_alg <span class="co"># âges dans alg</span></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;2&quot;  &quot;3&quot;  &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot;</span></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a>ages_manque <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(ages_alg, ages_alk); ages_manque</span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;2&quot;  &quot;3&quot;  &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot;</span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a>ages_dispo <span class="ot">&lt;-</span> al <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y<span class="dv">-1</span>, y, y <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(age) <span class="sc">%&gt;%</span> sort <span class="sc">%&gt;%</span> unique</span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a>ages_dispo <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(ages_dispo, ages_alk)</span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a>ages_manque <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(ages_manque, ages_dispo)</span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/53188034/change-background-colour-of-knitrkable-headers</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table1) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="fu">names</span>(table1))</span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(table1) <span class="sc">%in%</span> ages_alk)</span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table1)[cor] <span class="ot">&lt;-</span> <span class="fu">cell_spec</span>(<span class="fu">names</span>(table1)[cor], <span class="at">background =</span> <span class="st">&quot;green&quot;</span>, <span class="at">format =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(table1) <span class="sc">%in%</span> ages_manque)</span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table1)[cor] <span class="ot">&lt;-</span> <span class="fu">cell_spec</span>(<span class="fu">names</span>(table1)[cor], <span class="at">background =</span> <span class="st">&quot;red&quot;</span>, <span class="at">format =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">names</span>(table1) <span class="sc">%in%</span> ages_dispo)</span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(table1)[cor] <span class="ot">&lt;-</span> <span class="fu">cell_spec</span>(<span class="fu">names</span>(table1)[cor], <span class="at">background =</span> <span class="st">&quot;yellow&quot;</span>, <span class="at">format =</span> <span class="st">&quot;latex&quot;</span>)</span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(lf, al, C, y, p, r, g, period.unit, cacol, alcol, lfcol, o.lf, n.al, n.lf, le,</span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a>   o.al, this.al, temp, this.lf, alg, avec, alk, manque, ages_alk, ages_manque, cor)</span></code></pre></div>
</div>
<div id="calculs-pour-le-resdoc" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Calculs pour le resdoc</h1>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(catch_caa) <span class="co"># 4591 strates année-mois-OPANO-engin utilisées</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4591</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># FL</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">option_fl =</span> <span class="fu">unique</span>(option.lengthfreq)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(option_fl) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">perc_cum =</span> <span class="fu">cumsum</span>(perc))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 9 x 4</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   option_fl     n    perc perc_cum</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="do">##       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 1         1   310  6.75       6.75</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 2         2   343  7.47      14.2 </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 3         3  1237 26.9       41.2 </span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 4         4   873 19.0       60.2 </span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 5         5   823 17.9       78.1 </span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 6         6  1001 21.8       99.9 </span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 7         7     1  0.0218    99.9 </span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 8         8     2  0.0436   100.  </span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 9        11     1  0.0218   100</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span>, option.lengthfreq <span class="sc">&gt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, year, period, region, gear, option.lengthfreq)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 x 6</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="do">##      id  year period region gear          option.lengthfreq</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                     &lt;dbl&gt;</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  4543  1995      6 4Rb    Shrimp trawls                11</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  4544  1995      4 4Si    Shrimp trawls                 7</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  4545  1995      5 4Si    Shrimp trawls                 8</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  4546  1995      5 4Ss    Shrimp trawls                 8</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a><span class="co"># La majorité des strates atteignaient le niveau requis d&#39;échantillon &lt;= niveau 4. Les niveaux 7 à 12 n&#39;ont été utilisé que pour 4 strates, toutes de 1995 et avec le chalut à crevettes</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># ALK</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">option_age =</span> <span class="fu">unique</span>(option.agelength)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(option_age) <span class="sc">%&gt;%</span> </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">perc_cum =</span> <span class="fu">cumsum</span>(perc))</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 12 x 4</span></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a><span class="do">##    option_age     n   perc perc_cum</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="do">##         &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="do">##  1          1    65  1.42      1.42</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a><span class="do">##  2          2   180  3.92      5.34</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="do">##  3          3   742 16.2      21.5 </span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a><span class="do">##  4          4  1206 26.3      47.8 </span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a><span class="do">##  5          5   986 21.5      69.2 </span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="do">##  6          6  1183 25.8      95.0 </span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="do">##  7          7     5  0.109    95.1 </span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="do">##  8          8    14  0.305    95.4 </span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a><span class="do">##  9          9    43  0.937    96.4 </span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="do">## 10         10    45  0.980    97.3 </span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="do">## 11         11    93  2.03     99.4 </span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="do">## 12         12    29  0.632   100</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">option_age =</span> <span class="fu">unique</span>(option.agelength)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(option_age) <span class="sc">%&gt;%</span> </span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(option_age <span class="sc">&gt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(perc) <span class="sc">%&gt;%</span> sum</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4.98802</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(option.agelength <span class="sc">&gt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, year, gear) <span class="sc">%&gt;%</span> </span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(gear) <span class="sc">%&gt;%</span> </span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">year =</span> <span class="fu">paste</span>(<span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(year))), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 7 x 3</span></span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a><span class="do">##   gear              n year                                                      </span></span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;                                                     </span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Gillnets         46 2003                                                      </span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Hand gear         2 2003                                                      </span></span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Longlines        47 2003                                                      </span></span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Other trawls     17 2003                                                      </span></span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Seines            7 2003                                                      </span></span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Shrimp trawls   107 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 200~</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a><span class="do">## 7 Traps             3 2003</span></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a><span class="co"># La presque majorité des strates atteignaient le niveau requis d&#39;échantillons &lt;= niveau 4.</span></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Moins de 5 % des strates utilisent les niveaux 7-12. Pour les engins autres que le chalut à crevettes, </span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a><span class="co"># on parle toujours de l&#39;année 2003.</span></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(nsample.lengthfreq)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> summary </span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a><span class="do">##    2.00    3.00    6.00   18.48   17.00  778.00</span></span>
<span id="cb15-98"><a href="#cb15-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Les strates avaient en moyenne 18.48 échantillons pour faire leur FL (med = 6, min = 2, max = 778)</span></span>
<span id="cb15-99"><a href="#cb15-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">sum</span>(n.lf)) <span class="sc">%&gt;%</span> ungroup <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> summary</span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="do">##     2.0   479.5   880.0  1881.3  2151.0 26468.0</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Les strates avaient en moyenne 1881.3 morues pour faire leur FL (med = 880, min = 2, max = 26468)</span></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(nsample.agelength)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> summary </span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a><span class="do">##    2.00    5.00   10.00   22.97   22.00  522.00</span></span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Les strates avaient en moyenne 22.97 échantillons pour faire leur clé âge-longueur (med = 10, min = 2, max = 522)</span></span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(n.altot)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> summary </span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a><span class="do">##     3.0   161.0   260.0   431.8   585.0  2887.0</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Les strates avaient en moyenne 431.8 morues pour faire leur clé âge-longueur (med = 260, min = 3, max = 2887)</span></span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gear <span class="sc">==</span> <span class="st">&quot;Shrimp trawls&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(option.agelength) <span class="sc">%&gt;%</span> </span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>  ungroup</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 x 2</span></span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a><span class="do">##   option.agelength     n</span></span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a><span class="do">##              &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                9     9</span></span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a><span class="do">## 2               10    21</span></span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a><span class="do">## 3               11    77</span></span></code></pre></div>
<p>Est-ce que j’avais au moins 1 échantillon de FL/âge par strate <span class="math inline">\(k\)</span> avant de faire ma recherche pour des échantillons?</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Échantillons de fréquences de longueur</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(lf_caa<span class="sc">$</span>sample.id) <span class="co"># 3969 échantillons de FL pour la série 1993-2020</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 3969</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">group_by</span>(year, period, region, gear) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">summarise</span>(<span class="at">nb_samples =</span> <span class="fu">n_distinct</span>(sample.id)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>         ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">gear =</span> <span class="fu">as.character</span>(gear))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(catch_caa, ajout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;gear&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nb_samples)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">/</span> <span class="fu">nrow</span>(catch_caa) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 11.58789</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 11.58 % des strates contenaient &gt;= 1 échantillon au départ.</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Par année, ça ressemble à quoi?</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(catch_caa, ajout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;gear&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">n_tot =</span> <span class="fu">n</span>(),</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_strates =</span> <span class="fu">NROW</span>(year[<span class="sc">!</span><span class="fu">is.na</span>(nb_samples)]),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">perc =</span> n_strates <span class="sc">/</span> n_tot <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(perc)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>temp <span class="co"># 2003 est la pire année avec 1.61 %</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 28 x 4</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="do">##     year n_tot n_strates  perc</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  2003   124         2  1.61</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  2020   130         4  3.08</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  1994   165         7  4.24</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  2019   156         9  5.77</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  2011   161        11  6.83</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  2016   155        11  7.10</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  1998   171        13  7.60</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  2002   179        14  7.82</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  2009   178        15  8.43</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  2006   153        13  8.50</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 18 more rows</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(temp) <span class="co"># 1997 est la meilleure année avec 37.8</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 x 4</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="do">##    year n_tot n_strates  perc</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  2007   146        18  12.3</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  2017   151        20  13.2</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  1993   333        63  18.9</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  1995    84        24  28.6</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  1996   131        45  34.4</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  1997   180        68  37.8</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(temp<span class="sc">$</span>perc) <span class="co"># moyenne de 11.554</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="do">##   1.613   7.767   9.026  11.554  11.728  37.778</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Échantillons de lectures d&#39;otolithes</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(bio_caa<span class="sc">$</span>sample.id) <span class="co"># 1669 échantillons d&#39;âge pour la série 1993-2020</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1669</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>ajout <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> </span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>         <span class="fu">group_by</span>(year, period, region, gear) <span class="sc">%&gt;%</span> </span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>         <span class="fu">summarise</span>(<span class="at">nb_samples =</span> <span class="fu">n_distinct</span>(sample.id)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>         ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">gear =</span> <span class="fu">as.character</span>(gear))</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(catch_caa, ajout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;gear&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nb_samples)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>() <span class="sc">/</span> <span class="fu">nrow</span>(catch_caa) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 9.10477</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 9.1 % des strates contenaient &gt;= 1 échantillon au départ.</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Par année, ça ressemble à quoi?</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">left_join</span>(catch_caa, ajout, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;period&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;gear&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">n_tot =</span> <span class="fu">n</span>(),</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n_strates =</span> <span class="fu">NROW</span>(year[<span class="sc">!</span><span class="fu">is.na</span>(nb_samples)]),</span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>                  <span class="at">perc =</span> n_strates <span class="sc">/</span> n_tot <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(perc)</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>temp <span class="co"># 2003 est la pire année avec 0 %</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 28 x 4</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="do">##     year n_tot n_strates  perc</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="do">##  1  2003   124         0  0   </span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a><span class="do">##  2  1994   165         5  3.03</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a><span class="do">##  3  2020   130         4  3.08</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a><span class="do">##  4  2019   156         8  5.13</span></span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a><span class="do">##  5  2016   155         8  5.16</span></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a><span class="do">##  6  2011   161         9  5.59</span></span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a><span class="do">##  7  2012   153         9  5.88</span></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a><span class="do">##  8  2013   158        10  6.33</span></span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a><span class="do">##  9  2009   178        12  6.74</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a><span class="do">## 10  2010   172        12  6.98</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a><span class="do">## # ... with 18 more rows</span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(temp) <span class="co"># 2007 est la meilleure année avec 11</span></span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 x 4</span></span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a><span class="do">##    year n_tot n_strates  perc</span></span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;int&gt;     &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  2007   146        16  11.0</span></span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  1993   333        43  12.9</span></span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  2017   151        20  13.2</span></span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  1996   131        31  23.7</span></span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  1995    84        21  25  </span></span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  1997   180        45  25</span></span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(temp<span class="sc">$</span>perc) <span class="co"># moyenne de 9.164</span></span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a><span class="do">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a><span class="do">##   0.000   6.217   7.621   9.164   9.444  25.000</span></span></code></pre></div>
</div>
<div id="figures" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Figures</h1>
<div id="titres-des-axes" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Titres des axes</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;fr&quot;</span>){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation pour FL&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation&quot;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre d&#39;échantillons de FL&quot;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  lab4 <span class="ot">&lt;-</span> <span class="st">&quot;Nombre d&#39;échantillons&quot;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  lab5 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de morues pour les FL&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  lab6 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Nbre<span class="sc">~</span>de<span class="sc">~</span>morues<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  lab7 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation pour l&#39;âge&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  lab8 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre d&#39;échantillons d&#39;âge&quot;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  lab9 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de morues âgées&quot;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  lab10 <span class="ot">&lt;-</span> <span class="st">&quot;Nombre de morues&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  lab11 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de strates année-mois-région-engin&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  lab12 <span class="ot">&lt;-</span> <span class="st">&quot;Année&quot;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  lab13 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Débarquements<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span><span class="sc">~</span>t))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  lab14 <span class="ot">&lt;-</span> <span class="st">&quot;Âge&quot;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  lab15 <span class="ot">&lt;-</span> <span class="st">&quot;Masse moyenne à l&#39;âge (kg)&quot;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  lab16 <span class="ot">&lt;-</span> <span class="st">&quot;Longueur moyenne à l&#39;âge (cm)&quot;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  lab17 <span class="ot">&lt;-</span> <span class="st">&quot;% des débarquements annuels&quot;</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  lab18 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Échantillons d&#39;âge&quot;</span>, <span class="st">&quot;Échantillons de FL&quot;</span>)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;en&quot;</span>){</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;LF aggregation level&quot;</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Aggregation level&quot;</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of LF samples&quot;</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  lab4 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of samples&quot;</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  lab5 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of cod for LF&quot;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  lab6 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Nb<span class="sc">~</span>of<span class="sc">~</span>cod<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>))</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  lab7 <span class="ot">&lt;-</span> <span class="st">&quot;Age aggregation level&quot;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  lab8 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of age samples&quot;</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  lab9 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of aged cod&quot;</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>  lab10 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of cod&quot;</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  lab11 <span class="ot">&lt;-</span> <span class="st">&quot;Nb of year-month-region-gear strata&quot;</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  lab12 <span class="ot">&lt;-</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  lab13 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Landings<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span><span class="sc">~</span>t))</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>  lab14 <span class="ot">&lt;-</span> <span class="st">&quot;Age&quot;</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  lab15 <span class="ot">&lt;-</span> <span class="st">&quot;Mean weight at age (kg)&quot;</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  lab16 <span class="ot">&lt;-</span> <span class="st">&quot;Mean length at age (cm)&quot;</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  lab17 <span class="ot">&lt;-</span> <span class="st">&quot;% of annual landings&quot;</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  lab18 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Age samples&quot;</span>, <span class="st">&quot;LF samples&quot;</span>)</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation pour FL /</span><span class="sc">\n</span><span class="st">LF aggregation level&quot;</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation / Aggregation level&quot;</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre d&#39;échantillons de FL /</span><span class="sc">\n</span><span class="st">Nb of LF samples&quot;</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>  lab4 <span class="ot">&lt;-</span> <span class="st">&quot;Nombre d&#39;échantillons / Nb of samples&quot;</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  lab5 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de morues pour les FL /</span><span class="sc">\n</span><span class="st">Nb of cod for LF&quot;</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>  lab6 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Nbre<span class="sc">~</span>de<span class="sc">~</span>morues<span class="sc">~</span><span class="st">&quot;/&quot;</span><span class="sc">~</span>Nb<span class="sc">~</span>of<span class="sc">~</span>cod<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span>))</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  lab7 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;aggrégation pour l&#39;âge /</span><span class="sc">\n</span><span class="st">Age aggregation level&quot;</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  lab8 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre d&#39;échantillons d&#39;âge / Nb of age samples&quot;</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  lab9 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de morues âgées / Nb of aged cod&quot;</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>  lab10 <span class="ot">&lt;-</span> <span class="st">&quot;Nombre de morues / Nb of cod&quot;</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  lab11 <span class="ot">&lt;-</span> <span class="st">&quot;Nbre de strates année-mois-région-engin /</span><span class="sc">\n</span><span class="st">Nb of year-month-region-gear strata&quot;</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  lab12 <span class="ot">&lt;-</span> <span class="st">&quot;Année / Year&quot;</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  lab13 <span class="ot">&lt;-</span> <span class="fu">expression</span>(Débarquements<span class="sc">~</span><span class="st">&quot;/&quot;</span><span class="sc">~</span>Landings<span class="sc">~</span>(<span class="dv">10</span><span class="sc">^</span><span class="dv">3</span><span class="sc">~</span>t))</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  lab14 <span class="ot">&lt;-</span> <span class="st">&quot;Âge / Age&quot;</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  lab15 <span class="ot">&lt;-</span> <span class="st">&quot;Masse moyenne à l&#39;âge / Mean weight at age (kg)&quot;</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>  lab16 <span class="ot">&lt;-</span> <span class="st">&quot;Longueur moyenne à l&#39;âge / Mean length at age (cm)&quot;</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  lab17 <span class="ot">&lt;-</span> <span class="st">&quot;% des débarquements annuels / % of annual landings&quot;</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  lab18 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Échantillons d&#39;âge / Age samples&quot;</span>, <span class="st">&quot;Échantillons de FL / LF samples&quot;</span>)</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="graph1-résumé-de-caa_all" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> <code>graph1</code> : résumé de <code>caa_all</code></h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graph1: niveau d&#39;aggrégation LF</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">niveau =</span> <span class="fu">unique</span>(option.lengthfreq)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(niveau) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        count <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">full_join</span>(., <span class="fu">tibble</span>(<span class="at">niveau =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">by =</span> <span class="st">&quot;niveau&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">lab =</span> lab1,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">niveau =</span> <span class="fu">factor</span>(niveau, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ordered =</span> T),</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">n_lab =</span> <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, .))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>grapha <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> niveau, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab2, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(dat1<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">label =</span> n_lab, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)     </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co"># graph2: nbre d&#39;échantillons pour LF</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(nsample.lengthfreq),</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lab =</span> lab3) <span class="sc">%&gt;%</span> </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>        ungroup</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>dat2 <span class="sc">%&gt;%</span> </span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_strata =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n_strata <span class="sc">/</span> <span class="fu">nrow</span>(dat2) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">perccum =</span> <span class="fu">cumsum</span>(perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(perccum <span class="sc">&lt;=</span> <span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  max</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 42</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 42 Je vais mettre ma cassure de l&#39;axe des x à 50</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>max_x <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_x, <span class="dv">5</span>)</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>graphb <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat2 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nb <span class="sc">&lt;=</span> max_x), <span class="fu">aes</span>(<span class="at">x =</span> nb)) <span class="sc">+</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">center =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>          <span class="co"># bins de 1 échantillon, centrées</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab4, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_x))</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co"># graph3: nbre de morues pour LF</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>dat3 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">sum</span>(n.lf) <span class="sc">/</span> <span class="dv">1000</span>, <span class="co"># en milliers</span></span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lab =</span> lab5) <span class="sc">%&gt;%</span> </span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>        ungroup</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>dat3 <span class="sc">%&gt;%</span> </span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_strata =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n_strata <span class="sc">/</span> <span class="fu">nrow</span>(dat2) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>         <span class="at">perccum =</span> <span class="fu">cumsum</span>(perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(perccum <span class="sc">&lt;=</span> <span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a>  max</span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 6.132</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.132 </span></span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>max_x <span class="ot">&lt;-</span> <span class="fl">6.5</span></span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_x, <span class="fl">0.25</span>)</span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>graphc <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat3 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nb <span class="sc">&lt;=</span> max_x), <span class="fu">aes</span>(<span class="at">x =</span> nb)) <span class="sc">+</span></span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.250</span>, <span class="at">center =</span> <span class="fl">0.125</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>          <span class="co"># bins de 250 morues, centrées</span></span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab6, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_x))</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a><span class="co"># graph4: niveau d&#39;aggrégation âge</span></span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>dat4 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">niveau =</span> <span class="fu">unique</span>(option.agelength)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(niveau) <span class="sc">%&gt;%</span> </span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>        count <span class="sc">%&gt;%</span> </span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>        ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">full_join</span>(., <span class="fu">tibble</span>(<span class="at">niveau =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">by =</span> <span class="st">&quot;niveau&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n),</span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>               <span class="at">lab =</span> lab7,</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>               <span class="at">niveau =</span> <span class="fu">factor</span>(niveau, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ordered =</span> T),</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>               <span class="at">n_lab =</span> <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, .))</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>graphd <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat4, <span class="fu">aes</span>(<span class="at">x =</span> niveau, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab2, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(dat4<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">label =</span> n_lab, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)     </span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a><span class="co"># graph5: nbre d&#39;échantillons pour l&#39;âge</span></span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>dat5 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(nsample.agelength),</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lab =</span> lab8) <span class="sc">%&gt;%</span> </span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>        ungroup</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>dat5 <span class="sc">%&gt;%</span> </span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_strata =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n_strata <span class="sc">/</span> <span class="fu">nrow</span>(dat2) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>         <span class="at">perccum =</span> <span class="fu">cumsum</span>(perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(perccum <span class="sc">&lt;=</span> <span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>  max</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 76</span></span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a><span class="co"># 76 Je vais mettre ma cassure de l&#39;axe des x à 80</span></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>max_x <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_x, <span class="dv">5</span>)</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>graphe <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat5 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nb <span class="sc">&lt;=</span> max_x), <span class="fu">aes</span>(<span class="at">x =</span> nb)) <span class="sc">+</span></span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">center =</span> <span class="fl">2.5</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>          <span class="co"># bins de 1 échantillon, centrées</span></span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab4, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_x))</span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a><span class="co"># graph6: nbre de morues pour l&#39;âge</span></span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>dat6 <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarise</span>(<span class="at">nb =</span> <span class="fu">unique</span>(n.altot),</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lab =</span> lab9) <span class="sc">%&gt;%</span> </span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>        ungroup</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>dat6 <span class="sc">%&gt;%</span> </span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_strata =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> n_strata <span class="sc">/</span> <span class="fu">nrow</span>(dat2) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>         <span class="at">perccum =</span> <span class="fu">cumsum</span>(perc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(perccum <span class="sc">&lt;=</span> <span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(nb) <span class="sc">%&gt;%</span> </span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>  max</span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1119</span></span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a><span class="co"># 1119 </span></span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>max_x <span class="ot">&lt;-</span> <span class="dv">1200</span></span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, max_x, <span class="dv">200</span>)</span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>graphf <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat6 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nb <span class="sc">&lt;=</span> max_x), <span class="fu">aes</span>(<span class="at">x =</span> nb)) <span class="sc">+</span></span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">center =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>          <span class="co"># bins de 200 morues, centrées</span></span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> lab) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab10, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_x))</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(grapha, graphb, graphc, graphd, graphe, graphf, </span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_graphs_catchR_presentation_&quot;</span>, langue, <span class="st">&quot;.Rda&quot;</span>))</span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a>combi <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(grapha <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>                   graphb <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a>                   graphc <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a>                   graphd <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>                   graphe <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a>                   graphf <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>), </span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> F, <span class="at">labels =</span> <span class="st">&quot;AUTO&quot;</span>)</span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>y_title <span class="ot">&lt;-</span> <span class="fu">ggdraw</span>() <span class="sc">+</span> <span class="fu">draw_label</span>(<span class="at">label =</span> lab11, <span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/37052059/how-to-add-a-title-for-a-grid-layout-figure-in-ggplot2</span></span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a>graph1 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(y_title, combi, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="dv">1</span>)) <span class="co"># rel_heights values control title margins</span></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>graph1</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-18-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat1, dat2, dat3, dat4, dat5, dat6, grapha, graphb, graphc, graphd, graphe, graphf, combi, y_title)</span></code></pre></div>
</div>
<div id="graph2-aggrégation-fl" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> <code>graph2</code>: aggrégation FL</h2>
<p>Je le fais pour montrer 6 années d’intérêt:</p>
<ul>
<li>1993: une année avec beaucoup d’échantillonnage</li>
<li>1995: moratoire</li>
<li>2003: moratoire</li>
<li>2018-2010: les 3 dernières années</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1993</span>, <span class="dv">1995</span>, <span class="dv">2003</span>, <span class="dv">2018</span><span class="sc">:</span><span class="dv">2020</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(year <span class="sc">%in%</span> ans) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">niveau =</span> <span class="fu">unique</span>(option.lengthfreq),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">annee =</span> <span class="fu">unique</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>       ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(annee, niveau) <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>       count <span class="sc">%&gt;%</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>       ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">full_join</span>(., <span class="fu">expand.grid</span>(<span class="at">annee =</span> ans, <span class="at">niveau =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;annee&quot;</span>, <span class="st">&quot;niveau&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">niveau =</span> <span class="fu">factor</span>(niveau, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ordered =</span> T),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_lab =</span> <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, .))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>graph2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> niveau, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> annee) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab2, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>)) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(dat<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">label =</span> n_lab, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)     </span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>graph2</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-19-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat)</span></code></pre></div>
</div>
<div id="graph3-aggrégation-âge" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> <code>graph3</code>: aggrégation âge</h2>
<p>Je le fais seulement pour les 6 années d’intérêt</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(year <span class="sc">%in%</span> ans) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">summarise</span>(<span class="at">niveau =</span> <span class="fu">unique</span>(option.agelength),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">annee =</span> <span class="fu">unique</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>       ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>       <span class="fu">group_by</span>(annee, niveau) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>       count <span class="sc">%&gt;%</span> </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>       ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>       <span class="fu">full_join</span>(., <span class="fu">expand.grid</span>(<span class="at">annee =</span> ans, <span class="at">niveau =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;annee&quot;</span>, <span class="st">&quot;niveau&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(n), <span class="dv">0</span>, n),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">niveau =</span> <span class="fu">factor</span>(niveau, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">ordered =</span> T),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">n_lab =</span> <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;&quot;</span>, .))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>graph3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> niveau, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> annee) <span class="sc">+</span> <span class="co"># pour rajouter un titre</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab2, <span class="at">y =</span> lab11) <span class="sc">+</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>)) <span class="sc">+</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(dat<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> n, <span class="at">label =</span> n_lab, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)     </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>graph3</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-20-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat)</span></code></pre></div>
</div>
<div id="graph4-concordance-avec-déb." class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> <code>graph4</code>: concordance avec déb.</h2>
<p>Je vérifie que la somme des captures à l’âge annuelles totalisent bien les débarquements totaux calculés d’après <code>catch_caa</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tot <span class="ot">&lt;-</span> catch_caa <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">catch =</span> <span class="fu">sum</span>(catch)) <span class="sc">%&gt;%</span> ungroup</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(caa<span class="sc">$</span>avec_plus<span class="sc">$</span>age)); ages </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;0&quot;   &quot;1&quot;   &quot;10&quot;  &quot;11&quot;  &quot;12&quot;  &quot;13+&quot; &quot;2&quot;   &quot;3&quot;   &quot;4&quot;   &quot;5&quot;   &quot;6&quot;   &quot;7&quot;  </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [13] &quot;8&quot;   &quot;9&quot;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>caa<span class="sc">$</span>avec_plus<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(caa<span class="sc">$</span>avec_plus<span class="sc">$</span>age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">12</span>, <span class="st">&quot;13+&quot;</span>), <span class="at">ordered =</span> T)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> (<span class="fu">min</span>(my_year)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">max</span>(my_year) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>qual_col_pals <span class="ot">&lt;-</span> brewer.pal.info <span class="sc">%&gt;%</span> <span class="fu">filter</span>(category <span class="sc">==</span> <span class="st">&quot;qual&quot;</span>, colorblind <span class="sc">==</span> T)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>col_vector <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">mapply</span>(brewer.pal, qual_col_pals<span class="sc">$</span>maxcolors, <span class="fu">rownames</span>(qual_col_pals)))</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> col_vector[<span class="dv">1</span><span class="sc">:</span><span class="fu">n_distinct</span>(caa<span class="sc">$</span>avec_plus<span class="sc">$</span>age)]; cols</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1] &quot;#1B9E77&quot; &quot;#D95F02&quot; &quot;#7570B3&quot; &quot;#E7298A&quot; &quot;#66A61E&quot; &quot;#E6AB02&quot; &quot;#A6761D&quot;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  [8] &quot;#666666&quot; &quot;#A6CEE3&quot; &quot;#1F78B4&quot; &quot;#B2DF8A&quot; &quot;#33A02C&quot; &quot;#FB9A99&quot; &quot;#E31A1C&quot;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(tot<span class="sc">$</span>catch) <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span> <span class="co"># je vais mettre la limite supérieure à 20</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 18.45181</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>graph4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">data =</span> caa<span class="sc">$</span>avec_plus, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> caaw <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="at">fill =</span> age), <span class="co"># déb. en milliers de tonnes</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">width =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>(<span class="at">data =</span> tot, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> catch <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)) <span class="sc">+</span>  <span class="co"># débarquement en milliers de tonnes</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_line</span>(<span class="at">data =</span> tot, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> catch<span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>)) <span class="sc">+</span> <span class="co"># débarquement en milliers de tonnes</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab12, <span class="at">y =</span> lab13, <span class="at">fill =</span> lab14)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>graph4</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-21-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>caa<span class="sc">$</span>avec_plus <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">caaw =</span> <span class="fu">sum</span>(caaw)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., tot, <span class="at">by =</span> <span class="st">&quot;year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">abs</span>(caaw <span class="sc">-</span> catch) <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diff) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="do">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3.551e-05 1.021e-03 4.287e-03 8.884e-03 9.567e-03 8.772e-02</span></span></code></pre></div>
<p>Il existe des différences minimes (moy = 0.01, min = &lt; 0.001, max = 0.1 t) entre les valeurs reportées dans les données ZIFF et ce que je calcule avec <code>catchR</code>.</p>
</div>
<div id="graph5-overlinepds-à-lâge" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> <code>graph5</code>: <span class="math inline">\(\overline{pds}\)</span> à l’âge</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(caa<span class="sc">$</span>sans_plus<span class="sc">$</span>age) <span class="co"># seulement les âges 3 à 13 sont montrées dans les figures suivantes.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># caa$sans_plus %&gt;% filter(age %in% 0:2)</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>dat_graph <span class="ot">&lt;-</span> caa<span class="sc">$</span>sans_plus <span class="sc">%&gt;%</span> <span class="fu">filter</span>(age <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>)) </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># je ne montre que certaines longueurs</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>graph5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_graph, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> waa, <span class="at">group =</span> age, <span class="at">color =</span> age)) <span class="sc">+</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab12, <span class="at">y =</span> lab15, <span class="at">color =</span> lab14) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>graph5</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-22-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="graph6-overlinelongueur-à-lâge" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> <code>graph6</code>: <span class="math inline">\(\overline{longueur}\)</span> à l’âge</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>graph6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat_graph, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> laa, <span class="at">group =</span> age, <span class="at">color =</span> age)) <span class="sc">+</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_color_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab12, <span class="at">y =</span> lab16, <span class="at">color =</span> lab14) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>graph6</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-23-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="graph7-sum-des-débarquements-sim-niveau-daggrégation" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> <code>graph7</code>: <span class="math inline">\(\sum\)</span> des débarquements <span class="math inline">\(\sim\)</span> niveau d’aggrégation</h2>
<p>Cette figure est une suggestion d’Hugo Bourdages.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;catch&quot;</span>, <span class="st">&quot;option.agelength&quot;</span>), <span class="at">.funs =</span> unique) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(year, option.agelength) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise</span>(<span class="at">catch =</span> <span class="fu">sum</span>(catch, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">perc =</span> (catch <span class="sc">/</span> <span class="fu">sum</span>(catch)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">option =</span> option.agelength,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> lab18[<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>     ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(year, option, perc, type)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;catch&quot;</span>, <span class="st">&quot;option.lengthfreq&quot;</span>), <span class="at">.funs =</span> unique) <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(year, option.lengthfreq) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise</span>(<span class="at">catch =</span> <span class="fu">sum</span>(catch, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">perc =</span> (catch <span class="sc">/</span> <span class="fu">sum</span>(catch)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">option =</span> option.lengthfreq,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> lab18[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>     ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>     <span class="co">#filter(year == 1994)</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(year, option, perc, type)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>dat_graph <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(a,b) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">option =</span> <span class="fu">factor</span>(option, <span class="at">levels =</span> <span class="dv">12</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">ordered =</span> T))</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(a,b)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>labs_x <span class="ot">&lt;-</span> brks_x</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>labs_x[labs_x <span class="sc">%%</span> <span class="dv">5</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>graph7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_graph, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> perc, <span class="at">fill =</span> option)) <span class="sc">+</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span> type, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> brks_x, <span class="at">labels =</span> labs_x, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>          <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">reverse =</span> T)) <span class="sc">+</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab12, <span class="at">y =</span> lab17, <span class="at">fill =</span> lab2)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>graph7              </span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-24-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="graph8-vue-des-données-de-fl-et-dâge-disponibles" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> <code>graph8</code>: vue des données de FL et d’âge disponibles</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grapha</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;fr&quot;</span>){</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Année&quot;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Longueur (cm)&quot;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Length (cm)&quot;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>lf_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(length) <span class="sc">%&gt;%</span> range</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1]  11 148</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>brks_y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">150</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>labs_y <span class="ot">&lt;-</span> brks_y</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>labs_y[labs_y <span class="sc">%%</span> <span class="dv">25</span> <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Nbre de morues âgées</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> lf_caa <span class="sc">%&gt;%</span> </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># les données des observateurs ne sont pas montrées</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>      ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">lab =</span> <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm, <span class="at">trim =</span> T),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.8</span>, <span class="sc">-</span><span class="fl">1.8</span>), <span class="fu">length</span>(<span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>) <span class="sc">/</span> <span class="dv">2</span>))</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>grapha <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> lf_caa <span class="sc">%&gt;%</span> <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> length, <span class="at">group =</span> year)) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab1, <span class="at">y =</span> lab2) <span class="sc">+</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>), <span class="at">breaks =</span> brks_y, <span class="at">labels =</span> labs_y, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1992</span>, <span class="dv">2021</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">breaks =</span> <span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">labels =</span> <span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="at">data =</span> nb, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">label =</span> lab, <span class="at">vjust =</span> vjust), <span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>grapha</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-25-1.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># graphb</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;fr&quot;</span>){</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Oui&quot;</span>, <span class="st">&quot;Non&quot;</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Année&quot;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Âge&quot;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;Occurence&quot;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Year&quot;</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Age&quot;</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;Occurence&quot;</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">12</span>, <span class="at">name =</span> <span class="st">&quot;Paired&quot;</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(cols[<span class="dv">6</span>], cols[<span class="dv">4</span>])</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>dat_graph <span class="ot">&lt;-</span> bio_caa <span class="sc">%&gt;%</span> </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>             <span class="fu">filter</span>(source <span class="sc">==</span> <span class="st">&quot;quai&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># les données du relevé nGSL ne sont pas montrées</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(year, age) <span class="sc">%&gt;%</span> </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>             ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>             <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;age&quot;</span>, <span class="at">names_prefix =</span> <span class="st">&quot;a&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;n&quot;</span>, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;a&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;age&quot;</span>, <span class="at">names_prefix =</span> <span class="st">&quot;a&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">ifelse</span>(n <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;&quot;</span>, <span class="fu">format</span>(n, <span class="at">big.mark =</span> bm, <span class="at">trim =</span> T)),</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> <span class="fu">min</span>(bio_caa<span class="sc">$</span>age)<span class="sc">:</span><span class="fu">max</span>(bio_caa<span class="sc">$</span>age), <span class="at">ordered =</span> T),</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">year =</span> <span class="fu">factor</span>(year, <span class="at">levels =</span> <span class="dv">1993</span><span class="sc">:</span><span class="dv">2020</span>, <span class="at">ordered =</span> T),</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">occ =</span> <span class="fu">ifelse</span>(n <span class="sc">==</span> <span class="st">&quot;&quot;</span>, type[<span class="dv">2</span>], type[<span class="dv">1</span>]))</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>graphb <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_graph, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> age)) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> occ), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">n.dodge =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_y_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cols) <span class="sc">+</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">x =</span> lab1, <span class="at">y =</span> lab2, <span class="at">fill =</span> lab3) <span class="sc">+</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>graphb</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-25-2.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># combinaison</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>graph8 <span class="ot">&lt;-</span> <span class="fu">plot_grid</span>(grapha <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()), </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                    graphb, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="st">&quot;AUTO&quot;</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>graph8</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-25-3.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(grapha, graphb, dat_graph)</span></code></pre></div>
</div>
<div id="graph9-appariements-lf-vs-alk" class="section level2" number="8.10">
<h2><span class="header-section-number">8.10</span> <code>graph9</code>: appariements LF vs ALK</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (langue <span class="sc">==</span> <span class="st">&quot;fr&quot;</span>){</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Type d&#39;échantillon&quot;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Niveau d&#39;agrégation&quot;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;% des strates&quot;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FL&quot;</span>, <span class="st">&quot;Âge&quot;</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  lab4 <span class="ot">&lt;-</span> <span class="st">&quot; strates)&quot;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  lab1 <span class="ot">&lt;-</span> <span class="st">&quot;Sample type&quot;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  lab2 <span class="ot">&lt;-</span> <span class="st">&quot;Aggregation level&quot;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  lab3 <span class="ot">&lt;-</span> <span class="st">&quot;% of strata&quot;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;LF&quot;</span>, <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  lab4 <span class="ot">&lt;-</span> <span class="st">&quot; strata)&quot;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>dat_graph <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">distinct</span>(id, year, option.lengthfreq, option.agelength) <span class="sc">%&gt;%</span> </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(year, option.lengthfreq, option.agelength) <span class="sc">%&gt;%</span> </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>             ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xend =</span> <span class="dv">2</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> option.lengthfreq,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yend =</span> option.agelength) <span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">perc =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">select</span>(id, year, x, xend, y, yend, n, perc)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>caa_all <span class="sc">%&gt;%</span> </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, option.lengthfreq, option.agelength) <span class="sc">%&gt;%</span> </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(option.lengthfreq, option.agelength) <span class="sc">%&gt;%</span> </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> (n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(perc) <span class="sc">%&gt;%</span> </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  summary</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a><span class="do">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="do">##  0.02178  0.06535  0.30494  1.96078  1.25245 20.16990</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Je vais faire mes bins en conséquences</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>bins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>)</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Graphiques pour différentes périodes</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>pers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;1993:1998&quot;</span>, <span class="st">&quot;1999:2004&quot;</span>, <span class="st">&quot;2005:2010&quot;</span>, <span class="st">&quot;2011:2016&quot;</span>, <span class="st">&quot;2017:2020&quot;</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>table_n <span class="ot">&lt;-</span> caa_all <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n_strata =</span> <span class="fu">n_distinct</span>(id)) <span class="sc">%&gt;%</span> ungroup</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>dat_graph <span class="ot">&lt;-</span> <span class="fu">left_join</span>(dat_graph, table_n, <span class="at">by =</span> <span class="st">&quot;year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>             <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">paste0</span>(year, <span class="st">&quot; (&quot;</span>, n_strata, lab4))</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/61915427/ggplot-integer-breaks-on-facets</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>my_breaks <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">max</span>(x)</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (y <span class="sc">&gt;</span> <span class="dv">6</span>){</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a> } <span class="cf">else</span> {</span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a>my_limits <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { </span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">max</span>(x)</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (z <span class="sc">&gt;</span> <span class="dv">6</span>){</span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>   <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">12</span>)</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a> } <span class="cf">else</span> {</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>   <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>)</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> pers){</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>  graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat_graph <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text =</span> ii)), <span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>), year)), </span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, <span class="at">y =</span> y, <span class="at">yend =</span> yend, <span class="at">size =</span> perc, <span class="at">alpha =</span> perc)) <span class="sc">+</span></span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>           <span class="fu">geom_segment</span>(<span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lineend =</span> <span class="st">&quot;round&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">2.25</span>), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">labels =</span> types) <span class="sc">+</span></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_size_binned</span>(<span class="at">breaks =</span> bins, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="at">guide =</span> <span class="fu">guide_bins</span>(<span class="at">show.limits =</span> T)) <span class="sc">+</span></span>
<span id="cb33-77"><a href="#cb33-77" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_alpha_binned</span>(<span class="at">breaks =</span> bins, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">25</span>), <span class="at">guide =</span> <span class="fu">guide_bins</span>(<span class="at">show.limits =</span> T)) <span class="sc">+</span></span>
<span id="cb33-78"><a href="#cb33-78" aria-hidden="true" tabindex="-1"></a>           <span class="fu">labs</span>(<span class="at">x =</span> lab1, <span class="at">y =</span> lab2, <span class="at">size =</span> lab3, <span class="at">alpha =</span> lab3) <span class="sc">+</span></span>
<span id="cb33-79"><a href="#cb33-79" aria-hidden="true" tabindex="-1"></a>           <span class="fu">facet_wrap</span>(<span class="sc">~</span> year, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, ) <span class="sc">+</span></span>
<span id="cb33-80"><a href="#cb33-80" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> my_breaks, <span class="at">limits =</span> my_limits)</span>
<span id="cb33-81"><a href="#cb33-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(graph)</span>
<span id="cb33-82"><a href="#cb33-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-83"><a href="#cb33-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&quot;graph9_&quot;</span>, <span class="fu">gsub</span>(<span class="st">&quot;:&quot;</span>, <span class="st">&quot;_&quot;</span>, ii)), <span class="at">value =</span> graph)</span>
<span id="cb33-84"><a href="#cb33-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(graph)</span>
<span id="cb33-85"><a href="#cb33-85" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="03_calculs_files/figure-html/unnamed-chunk-26-1.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-26-2.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-26-3.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-26-4.png" width="864" style="display: block; margin: auto;" /><img src="03_calculs_files/figure-html/unnamed-chunk-26-5.png" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(dat_graph, bins, pers, table_n, my_breaks, my_limits)</span></code></pre></div>
</div>
</div>
<div id="travail-sur-lw" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Travail sur <code>lw</code></h1>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lw) <span class="co"># 336 obs et 9 var</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 336   9</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>lw <span class="ot">&lt;-</span> lw <span class="sc">%&gt;%</span> <span class="co"># pour le resdoc</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(annee, n_brute, n_net, intercept, slope, r_squared, source) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">mois =</span> <span class="fu">paste</span>(<span class="fu">as.character</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(mois), <span class="at">na.last =</span> F)), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">mois =</span> <span class="fu">ifelse</span>(mois <span class="sc">==</span> <span class="fu">paste</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;1-12&quot;</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(mois <span class="sc">==</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span>), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;1-3, 10-12&quot;</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">ifelse</span>(mois <span class="sc">==</span> <span class="fu">paste</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;4-9&quot;</span>, <span class="cn">NA</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(annee, mois, n_brute, n_net, intercept, slope, r_squared, source) <span class="sc">%&gt;%</span> </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(annee, mois)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lw) <span class="co"># 30 obs et 8 var</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 30  8</span></span></code></pre></div>
</div>
<div id="sauvegarde" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Sauvegarde</h1>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(table1, <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_tables_&quot;</span>, langue, <span class="st">&quot;.Rda&quot;</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(lw, <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_relations_masse-longueur_aggrege.Rda&quot;</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(<span class="at">list =</span> <span class="fu">ls</span>(<span class="at">pattern =</span> <span class="st">&quot;graph[0-9]+&quot;</span>), <span class="at">file =</span> <span class="fu">paste0</span>(result, <span class="st">&quot;03_graphs_&quot;</span>, langue, <span class="st">&quot;.Rda&quot;</span>))</span></code></pre></div>
</div>
<div id="références-citées" class="section level1 unnumbered">
<h1 class="unnumbered">Références citées</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bourdages2011_fr" class="csl-entry">
Bourdages, H., et Ouellet, J.-F. 2011. <span>Répartition géographique et indices d’abondance des poissons marins du nord du golfe du Saint-Laurent (1990–2009)</span>. Rapp. tech. can. sci. halieut. aquat. 2963: vi + 171 p.
</div>
<div id="ref-Frechet1992_fr" class="csl-entry">
Fréchet, A., et Schwab, P. 1992. <span>Évaluation du stock de morue du nord du Golfe du Saint-Laurent (3Pn, 4RS) en 1991</span>. CSCPCA Doc. de Rech. 92/77: 50 p.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
